# Recommended RabbitMQ configuration for Microservices

# CRITICAL FIX: The Bitnami repository is no longer free/public on Docker Hub.
# Switching to the OFFICIAL Docker Library image, which is stable and free.
image:
  # Using the official public repository path: docker.io/library/rabbitmq
  repository: docker.io/library/rabbitmq
  # CRITICAL: Using the specified stable tag with management plugin on Alpine base
  tag: 4.1.6-management-alpine 
  pullPolicy: IfNotPresent
  
auth:
  # ðŸ›‘ CRITICAL: Remove hardcoded values and configure Secret usage
  enabled: false # Ensure 'auth' section is not trying to generate its own secret

  # Tell the chart to use a pre-existing Secret instead of generating one
  existingSecret: rabbitmq-broker-creds # The K8s Secret name created by ESO
  # Note: The chart must support this 'existingSecret' parameter. 
  # If it doesn't, you may need to patch the chart's deployment template.

  # You may still need to keep the username field if the chart's template requires it
  username: user
  # Remove password field entirely:
  # password: rabbitmq-secret-password-placeholder 
  erlangCookie: "long-random-string-for-clustering"

# Enable persistence (CRITICAL for production)
persistence:
  enabled: true
  storageClass: "default" # Use your cluster's default storage class
  size: 10Gi

# Enable the Management Plugin (for UI access and testing)
# We will use this to verify the queue is functioning.
metrics:
  enabled: true
  service:
    type: ClusterIP
    port: 15692 # Metrics port

ingress:
  enabled: false # Use Istio VirtualService for external access, not standard Ingress

# Resource limits (adjust based on load)
resources:
  requests:
    cpu: 250m
    memory: 512Mi
  limits:
    cpu: 500m
    memory: 1024Mi