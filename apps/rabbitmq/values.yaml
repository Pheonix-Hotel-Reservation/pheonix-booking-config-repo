# Recommended RabbitMQ configuration for Microservices

# CRITICAL FIX: The Bitnami repository is no longer free/public on Docker Hub.
# Switching to the OFFICIAL Docker Library image, which is stable and free.
image:
  # Using the official public repository path: docker.io/library/rabbitmq
  repository: docker.io/library/rabbitmq
  # CRITICAL: Using the specified stable tag with management plugin on Alpine base
  tag: 4.1.6-management-alpine 
  pullPolicy: IfNotPresent
  
# CRITICAL: Inject environment variables to force the desired user creation
extraEnv:
- name: RABBITMQ_DEFAULT_USER
  value: "user" # Your desired username
- name: RABBITMQ_DEFAULT_PASS
  # Inject the password directly from your secret
  valueFrom:
    secretKeyRef:
      name: rabbitmq # Your existing secret
      key: rabbitmq-pass # The key name holding the password

# Enable persistence (CRITICAL for production)
persistence:
  enabled: true
  storageClass: "default" # Use your cluster's default storage class
  size: 10Gi

# Enable the Management Plugin (for UI access and testing)
# We will use this to verify the queue is functioning.
metrics:
  enabled: true
  service:
    type: ClusterIP
    port: 15692 # Metrics port

ingress:
  enabled: false # Use Istio VirtualService for external access, not standard Ingress

# Resource limits (adjust based on load)
resources:
  requests:
    cpu: 250m
    memory: 512Mi
  limits:
    cpu: 500m
    memory: 1024Mi