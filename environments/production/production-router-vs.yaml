apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: phoenix-prodution-router
  namespace: phoenix-production # Deploy in the application namespace
spec:
  hosts:
    - "pheonix.live"
    - "prod.pheonix.live"
  gateways:
    - istio-ingress/production-gateway # Binds to the new dedicated production gateway
  http:
  
  # 1. Route for User Service (Highest Priority: Specific Path Match)
  - match:
    - uri:
        # CRITICAL: Match traffic starting with /api/user
        prefix: /api/users 
    route:
    - destination:
        host: user-service.phoenix-production.svc.cluster.local # Internal FQDN
        port:
          number: 3001 # App's internal port
  
  # 3. Catch-all for Root/Static Content
  - match:
    - uri:
        prefix: / 
    route:
    - destination:
        # You can point this to a static front-end service or another entry point
        host: frontend.phoenix-production.svc.cluster.local
        port:
          number: 80
