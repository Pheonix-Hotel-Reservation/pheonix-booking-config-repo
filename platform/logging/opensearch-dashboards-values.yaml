# path: platform/logging/opensearch-dashboards-values.yaml

# Configuration for the OpenSearch Dashboards (UI) component
# Note: The release name of the cluster is assumed to be 'opensearch-cluster'


opensearchHosts: "https://opensearch-cluster-data.opensearch.svc.cluster.local:9200"

config:
  opensearch_dashboards.yml:
    # Set the host to the correct internal service
    opensearch.hosts: [ "https://opensearch-cluster-data.opensearch.svc.cluster.local:9200" ]
    
    # CRITICAL: Configure the pod to use the injected ENV VAR for Basic Auth
    opensearch.requestHeadersAllowlist: [ "Authorization" ]
    opensearch.username: "admin"
    opensearch.password: ${OPENSEARCH_ADMIN_PASSWORD} # <-- This is the secure reference

# Resources (adjust for your cluster size)
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Security Configuration (If your cluster requires internal mTLS or username/pass)
# If OpenSearch requires authentication, you must configure a secret mount here.
# For simplicity, we are assuming internal K8s traffic is authenticated via Istio mTLS.

# In platform/logging/opensearch-dashboards-values.yaml

# Inject the secret data as an environment variable
extraEnvs:
  - name: OPENSEARCH_ADMIN_PASSWORD
    valueFrom:
      secretKeyRef:
        name: opensearch-admin-secret # The K8s Secret created by ESO
        key: value                   # The key holding the password
